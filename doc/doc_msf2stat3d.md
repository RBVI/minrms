msf2stat3d
==========

## Syntax:
```
msf2stat3d [-oGg] msf_file labelA labelB pdb_fileA pdb_fileB
```

## Overview

msf2stat3d superimposes the structures in pdb_fileA and pdb_fileB
in order to minimize the root-mean-squared-displacement (RMSD)
between matched CA atoms according to the alignment stored
in msf_file.  It then calculates several structural properties
which are returned to the user.


## Input format

- msf_file is an MSF file containing an alignment between
  two or more sequences.  The MSF file format is explained
  [here.](http://rothlab.ucdavis.edu/genhelp/chapter_2_using_sequences.html#_Specifying_RSF_Files)
  *(MSF files can be converted to and from other
  more popular alignment file formats (such as FASTA) using
[aligncopy](http://emboss.sourceforge.net/apps/cvs/emboss/apps/aligncopy.html))*
- pdb_fileA and pdb_fileB should contain structures corresponding
  to the sequences in the msf_file prefixed by the
  labelA and labelB identifiers, respectively.


## Output format

Example output format:
```
        N 100
     RMSD 3.0
    P_str 2.0e-08
 max_dist 8.0

Transform Matrix to apply to structure: pdb1lyz.ent
0.55 -0.29 -0.78 61.65 
0.78 0.51 0.36 -23.12 
0.30 -0.81 0.51 22.11 
```

Where:
- N is the number of matched pairs of residues in the alignment
- RMSD is the root-mean-squared-distance between
  matched pairs of residues.
- P_str is the probability-score based on S_str, as published in
  [Levitt M, Gerstein M, PNAS 1998, 95(11):5913-20](https://doi.org/10.1073/pnas.95.11.5913)
- max-dist is the maximum distance between any pair of alpha-carbon
  atoms that were matched in the alignment.
  (Note: This is not effected by the "atoms_used.txt" file.  See below.)
- Transformation Matrix Section:
  indicates the relative position of the two molecules after optimal
  superposition.  It specifies of a rotation and a translation to
  apply to the positions of atoms in the indicated structure,
  in order to minimize the RMSD between matched atoms in the alignment.
  (Note: This matrix can be passed to as an argument rotate_pdb.)


## Matrix Format

When superimposing the structures, only the indicated structure
(in the above example: "pdb1lyz.ent"), is moved.
Let X,Y,Z denote the position of an atom in that structure
("pdb1lyz.ent") before optimal superposition,
and let X', Y', Z' be the position of that atom afterwards.
The transformation of coordinates from X,Y,Z to X',Y',Z' is:
```
   X' = M11*X + M12*Y + M13*Z  +  M14
   Y' = M21*X + M22*Y + M23*Z  +  M24
   Z' = M31*X + M32*Y + M33*Z  +  M34
```
where Mij is the 3x4 matrix returned to the user.


## Optional Arguments


### -o

The properties calculated by msf2stat3d depend on
the relative orientation between the two structures.
By default, msf2stat3d superimposes the structures to
minimize the RMSD between the positions of corresponding atoms.
The user can dissable this behavior by passing the -o flag,
which leaves the structures in their original orientations.
(By using the rotate_pdb program, or visualization software,
the user can move the the two structures to any position
they desire, and then invoke msf2stat3d -o on the rotated
structures.)

## Options for visualizing the alignment in Chimera:

### -g

If the -g command line option is specified, msf2stat3d creates
a graphics object file (with a ".gfx" extension)
containing a wireframe 3-D image of the superposition between
the two structures, and the residues that were matched,
viewable in Chimera.
The two structures are displayed in white and cyan.
Corresponding atoms are connected by red-line-segments
(or small red markers if the line segments are too short
 to see clearly).

### -G

The -G option is the same as the -g option, producing a
Midas/Chimera graphics object file displaying the structural alignment.
However, if -G is used, only line segments connecting
matched atoms are drawn (in red).
The two superimposed structures are not drawn.

#### Explanation of Usage:

The -G option allows the user the freedom to display these
structures by some other means (not necessarily in wireframe).
In Chimera you can display multiple structures
at once: the two structures being aligned, and a separate
graphics object file displaying the matched atoms.
To superimpose the two structures correctly, one would have
to generate an additional PDB-file, one whose structure was
rotated correctly to the other structure.  To do this, invoke
the rotate_pdb program on one of the two PDB files,
using the transformation-matrix output of msf2stat3d.
The new, rotated PDB-file could then be displayed simultaneously
along with the PDB-file containing the other structure, and the
graphics-object-file generated by msf2stat3d -G.
Users would then have the freedom to use the features of
Chimera allowing them to highlight certain residues
from the two molecules or display them in alternate ways,
like using ribbons or spheres.
This is not possible using one graphics object file alone
to represent the entire scene.


## Configuration files:

If an "atoms_used.txt" file is located in the directory in which
msf2stat3d is invoked, msf2stat3d will use the positions of the
atoms specified in that file (instead of " CA" atoms), in order
to calculate RMSD, and to physically superimpose the two
structures.  This format of this file is documented in the
minrms documentation.
